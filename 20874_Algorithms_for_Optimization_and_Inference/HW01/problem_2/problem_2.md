# Problem 2: IP Modelling of K-means Clustering
## Theoretical Model
As shown in class, the optimal centroid for a given cluster is the mean of the points belonging to that cluster. Hence, the possible centroids are a finite number, i.e., the means of all possible clusters. 

Notice that identical points are assigned to the same centroid. Multiple occurences of a point are influencial only for the mean of the cluster containing those points, which will be skewed towards the ones with high frequency. Thus, we can simplify this problem by considering only unique points and store their frequency in the original set as a weight to use when computing tentative centroids and the objective function.  

Given a set of $P$ points, denote with $i = 1, ..., N$ the unique points with coordinates $p_i$, clearly $N \le P$. There are $j=1, ..., 2^N-1$ possible centroids with coordinates $c_j$, obtained by taking the mean of all possible non-empty subset of unique points, weighted by each unique point's frequency in the original set.
$$
c_j = \frac{1}{|S_j|}\sum_{p_i \in S_j} p_i\cdot w_i
$$
where $S_j$ are all possible subsets of unique points and $w_i$ their frequency in the original set.  

To model an IP, we further define the following variables:
-  $y_j \in \{0,1\}$ whether or not we choose centroid $j$
-  $x_{ij} \in  \{0,1\}$ whether or not we assign point $i$ to centroid $j$

And parameter:
-  $d_{ij} = ||i - j||^2$ the distance of point $i$ from centroid $j$  
  
We model K-means as follows:
$$
\min_{y_i, x_{ij}} \sum_{j=1}^{2^N-1}\sum_{i=1}^Nx_{ij}d_{ij}w_i\\
s.t. \\
Ny_j \ge \sum_{i=1}^{N}x_{ij} \hspace{5mm} \forall j = 1, ..., 2^N-1 \\
\sum_{j=1}^{s^N-1} y_j = k \\
\sum_{j=1}^{2^N-1}x_{ij} = 1 \hspace{5mm} \forall i = 1, ..., N 
$$

The constraints force to assign each point to exactly $1$ centroid and to choose at most $k$ of them.  

We can reduce the number of centroids considered by picking only those generated by a cluster whose sum of distances is less than the objective function value found with K-means.

Moreover, we can avoid considering all those centroids generated by cluster with more than $N-k+2$ elements. In fact, this would lead to $N-N+k-2=k-2$ points and $k-1$ centroids left to be generated. It's optimal to set $k-2$ centroids to the remaining $k-2$ points. However, we are still left with one free centroid and it's always optimal to remove one point from the first cluster and assign to a centroid with same coordinates, hence reducing to clusters with at most $N-k+1$ elements.

## Implementation
In order to compress an image using IP do the following from the directory `/HW01/`:
1. `python problem_1/recolor.py 20col.png 8col.png 8` to get the compression via k-means using lloyd algorithm
2. `python problem_2/generate_centroids_and_dat.py <obj>` to generate the tentative centroids and write the `.dat` file. The `<obj>` is copy-pasted from the output of the previous command
3. `glpsol --model problem_3/main.mod --data problem_3/main.dat > problem_3/out.txt` to choose the optimal centroids via IP and store the result.
4. `python problem_3/visualize_ip_compression.py` to visualize the result