# Problem 2: IP Modelling of K-means Clustering
## Theoretical Model
As shown in class, the optimal centroid for a given cluster is the mean of the points belonging to that cluster. Hence, the possible centroids are a finite number, i.e., the means of all possible clusters. 

Denote with $i = 1, ..., N$ the unique colors in the image. It follows there are $2^N-1$ possible centroids, given by the means of all possible non-empty subsets of colors.  
We define the following variables:
-  $y_j \in \{0,1\}$ whether or not we choose centroid $j$
-  $x_{ij} \in  \{0,1\}$ whether or not we assign color $i$ to centroid $j$

And parameters:
-  $w_{i}$ the number of pixels whose color is $j$
-  $d_{ij} = ||i - j||^2$ the distance of color $i$ from centroid $j$  
  
We can model K-means with the following IP:
$$
\min_{y_i, x_{ij}} \sum_{j=1}^{2^N-1}\sum_{i=1}^Nx_{ij}d_{ij}w_i\\
s.t. \\
Ny_j \ge \sum_{i=1}^{N}x_{ij} \hspace{5mm} \forall j = 1, ..., 2^N-1 \\
\sum_{j=1}^{s^N-1} y_j = k \\
\sum_{j=1}^{2^N-1}x_{ij} = 1 \hspace{5mm} \forall i = 1, ..., N 
$$

The constraints force to assign each point to exaclty 1 centroid and to choose at most $k$ of them.  
We can reduce the number of centroids considered by picking only those generated by a cluster whose sum of distances is less than the objective function value found with K-means.

## Implementation
In order to compress an image using IP do the following from the directory `/HW01/`:
1. `python problem_1/recolor.py 20col.png 8col.png 8` to get the compression via k-means using lloyd algorithm
2. `python problem_2/generate_centroids_and_dat.py <obj>` to generate the tentative centroids and write the `.dat` file. The `<obj>` is copy-pasted from the output of the previous command
3. `glpsol --model problem_3/main.mod --data problem_3/main.dat > problem_3/out.txt` to choose the optimal centroids via IP and store the result.
4. `python problem_3/visualize_ip_compression.py` to visualize the result